---
date: '2024-06-21 17:01:17'
title: çº¢é»‘æ ‘
top: 0
outline: deep
tags:
- äºŒå‰æœç´¢æ ‘
- çº¢é»‘æ ‘
- æ•°æ®ç»“æ„
- å¹³è¡¡æ ‘
- AVLæ ‘
- Bæ ‘
---

ç”±äºc++é‡Œå·²ç»æœ‰ç°æˆçš„çº¢é»‘æ ‘(map)ï¼Œ æ‰€ä»¥ä¹‹å‰ç”±äºæ²¡æœ‰åº”ç”¨åœºæ™¯ï¼Œ ä¸€ç›´æ²¡æœ‰å»äº†è§£çº¢é»‘æ ‘ã€‚

ç°åœ¨ä¸ºä»€ä¹ˆä¼šå»å­¦ä¹ çº¢é»‘æ ‘:

1. jsçš„mapå¾ˆä¸å¥½ç”¨
    1. å¿…é¡»é€šè¿‡getã€setå‡½æ•°æ“ä½œå€¼
    2. æ²¡æœ‰é»˜è®¤å€¼
2. jsçš„mapåº•å±‚ä¸æ˜¯ç”±çº¢é»‘æ ‘å®ç°ï¼Œ å¯¼å‡ºçš„æ•°æ®é¡ºåºç”šè‡³æ˜¯æ’å…¥é¡ºåº

æœ¬æ¥æƒ³æ‰¾ä¸€äº›ç¬¬ä¸‰æ–¹åº“ï¼Œ ä½†å¹¶æ²¡æœ‰æ‰¾åˆ°æ¯”è¾ƒå¥½çš„, äºæ˜¯æ‰“ç®—è‡ªè¡Œå¡«äº†çº¢é»‘æ ‘è¿™ä¸ªå‘, å®ç°å·¥å…·è‡ªç»™è‡ªè¶³ã€‚

---

å‰è¨€: çº¢é»‘æ ‘æ˜¯è¾ƒä¸ºå¤æ‚çš„æ•°æ®ç»“æ„, æœ‰æ¯”è¾ƒå¤šçš„èƒŒæ™¯çŸ¥è¯†, æ‰€ä»¥æœ¬æ–‡å°†ä»ç§‘æ™®å¹³è¡¡æ ‘çš„è§’åº¦å‡ºå‘æ€»ç»“å¹³è¡¡æ ‘å®¶æ—å’Œçº¢é»‘æ ‘ç”±æ¥ã€‚

## BST(äºŒå‰æœç´¢æ ‘)

äºŒå‰æœç´¢æ ‘åœ¨äºŒå‰æ ‘çš„åŸºç¡€ä¸Šå¢åŠ äº†å¦‚ä¸‹æ€§è´¨çš„è¦æ±‚: 

1. ç©ºæ ‘æ˜¯ä¸€é¢—äºŒå‰æœç´¢æ ‘
2. äºŒå‰æœç´¢æ ‘çš„å·¦å­æ ‘ä¸Šä»»æ„ç»“ç‚¹çš„æƒå€¼å°äºæ ¹ç»“ç‚¹
3. äºŒå‰æœç´¢æ ‘çš„å³å­æ ‘ä¸Šä»»æ„ç»“ç‚¹çš„æƒå€¼å¤§äºæ ¹ç»“ç‚¹
4. äºŒå‰æœç´¢æ ‘çš„å·¦å³å­æ ‘å‡ä¸ºäºŒå‰æœç´¢æ ‘

>  ä»ä¸Šé¢å¯ä»¥çœ‹å‡ºBSTæœ‰ä¸ªéšå¼çš„è¦æ±‚æ˜¯ä¸èƒ½å‡ºç°ä¸¤ä¸ªæƒå€¼ç›¸ç­‰çš„ç»“ç‚¹ï¼Œ å¯¹äºè¿™ç§æƒ…å†µçš„å¤„ç†ä¸€èˆ¬æ˜¯æ ¹æ®åœºæ™¯é€‰æ‹©<åæ¥è€…è¦†ç›–å‰è€…>æˆ–è€…<æ·»åŠ ç»“ç‚¹countå€¼>

BSTå¯ä»¥å¾ˆå¥½çš„è§£å†³å¯å˜åºåˆ—çš„æœç´¢é—®é¢˜ã€‚ è¯•æƒ³ä¸€ä¸ªæ•°ç»„é‡Œï¼Œ å®ƒå°†æ¥å¯èƒ½éœ€è¦åˆ é™¤æŸä¸ªå…ƒç´ ï¼Œ ä¹Ÿå¯èƒ½ä¼šæ·»åŠ è¿›æ¥ä¸€äº›å…ƒç´ ï¼Œ ä½ éœ€è¦åœ¨è¿™äº›æƒ…å†µå‘ç”Ÿçš„åŒæ—¶æ»¡è¶³è¾ƒå¿«çš„æœç´¢ã€‚

### BSTçš„æŸ¥æ‰¾

å°†æœç´¢å€¼ä»æ ¹ç»“ç‚¹å¼€å§‹æ¯”è¾ƒ: 

* å½“å‰ç»“ç‚¹æƒå€¼ä¸æœç´¢å€¼ç›¸åŒ: æ‰¾åˆ°äº†
* å½“å‰ç»“ç‚¹æƒå€¼å°äºæœç´¢å€¼ï¼š ä¸å·¦å­©å­è¿›è¡Œæ¯”è¾ƒ
* å½“å‰ç»“ç‚¹æƒå€¼å¤§äºæœç´¢å€¼: ä¸å³å­©å­è¿›è¡Œæ¯”è¾ƒ
* å½“å‰ç»“ç‚¹ä¸ºç©ºï¼š æŸ¥æ‰¾å¤±è´¥ï¼Œ ä¸å­˜åœ¨

```typescript
searchNode(root: N | null, key: K): N | null {
    if (root === null) return null;
    const compareResult = this.compare(root.key, key);
    switch (compareResult) {
      case COMPARE_RESULT.EQUAL:
        return root;
      case COMPARE_RESULT.LESS:
        return this.searchNode(root.left, key);
      case COMPARE_RESULT.MORE:
        return this.searchNode(root.right, key);
    }
  }
```



BSTçš„æ·»åŠ æ“ä½œä¸æ­¤ç±»ä¼¼ï¼Œ ä¸å†é‡å¤ã€‚

### BSTçš„åˆ é™¤

é¦–å…ˆåœ¨æœç´¢æ ‘ä¸­æŸ¥æ‰¾åˆ°å¾…åˆ é™¤å€¼å¯¹åº”çš„ç»“ç‚¹ã€‚

* å¾…åˆ é™¤ç»“ç‚¹ä¸ºå¶å­ç»“ç‚¹: ç›´æ¥åˆ é™¤å³å¯
* å¾…åˆ é™¤ç»“ç‚¹åªæœ‰ä¸€ä¸ªå„¿å­: åˆ é™¤ç»“ç‚¹åï¼Œ è®©å”¯ä¸€çš„å„¿å­é¡¶æ›¿å…¶ä½ç½®å³å¯
* å¾…åˆ é™¤ç»“ç‚¹æœ‰ä¸¤ä¸ªå„¿å­: åˆ é™¤ç»“ç‚¹ï¼Œ ä½¿ç”¨å…¶ã€å‰é©±ã€‘æˆ–ã€åç»§ã€‘é¡¶æ›¿å…¶ä½ç½®

é‡ç‚¹è§£é‡Šã€å‰é©±ã€‘å’Œã€åç»§ã€‘æ˜¯ä»€ä¹ˆï¼Œ ä»¥åŠä¸ºä»€ä¹ˆå¯ä»¥è®©å®ƒä»¬é¡¶æ›¿ã€‚

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD
A((5)) --> B((3))
A --> C((7))
B --> D((2))
B --> E((4))
C --> F((6))
C --> G((8))

classDef commonNode fill: black,color: white,stroke:none
class A,B,C,D,E,F,G commonNode
```

ä»¥æ­¤æ ‘è·ç¦»ï¼Œ æ­¤æ ‘çš„ä¸­åºéå†åºåˆ—ä¸º

```
2, 3, 4, 5, 6, 7, 8
```

å¯¹äº($5$)æ¥è¯´ï¼Œ ($4$)å’Œ($6$)åˆ†åˆ«æ˜¯å®ƒçš„å‰é©±ã€åç»§ï¼Œ å› ä¸ºåœ¨ä¸­åºåºåˆ—ä¸­å®ƒä»¬æ˜¯($5$)çš„å‰åä¸¤ä¸ªç»“ç‚¹ã€‚

å½“($5$)è¢«åˆ é™¤æ—¶ï¼Œ ä½¿ç”¨ ($4$)æˆ–($6$)æ¥é¡¶æ›¿å®ƒçš„ä½ç½®ï¼Œ ä¸ä¼šç ´åæœç´¢æ ‘çš„æ€§è´¨ï¼Œ ä»¥($4$)ä¸¾ä¾‹ã€‚

**æ³¨**:  *NILè¡¨ç¤ºå ä½çš„ç©ºèŠ‚ç‚¹*

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD
subgraph åˆ é™¤5å
A((4)) --> B((3))
A --> C((7))
B --> D((2))
B --> NIL
C --> F((6))
C --> G((8))
end
subgraph åˆ é™¤5å‰
a((5)) --> b((3))
a --> c((7))
b --> d((2))
b --> e((4))
c --> f((6))
c --> g((8))
end

classDef commonNode fill: black,color: white,stroke:none
class A,B,C,D,E,F,G,a,b,c,d,e,f,g,NIL commonNode
```

å¯ä»¥å‘ç°ï¼Œ ç”±äº($4$)æ»¡è¶³

1. å¤§äº5å·¦å­æ ‘æ‰€æœ‰ç»“ç‚¹(é™¤äº†4)
2. å°äº5å³å­æ ‘æ‰€æœ‰ç»“ç‚¹

æ‰€ä»¥4å¤©ç„¶å¯ä»¥å–ä»£5çš„ä½ç½®ï¼›6åŒç†ã€‚

Nçš„å‰é©±å’Œåç»§çš„å®šä¹‰å¯ä»¥ç®€åŒ–ä¸º:Nå·¦å­æ ‘ä¸­æƒå€¼æœ€å¤§çš„ç»“ç‚¹ã€Nå³å­æ ‘ä¸­æƒå€¼æœ€å°çš„ç»“ç‚¹ã€‚

### BSTçš„æœ€åæƒ…å†µ

BSTè¿›è¡Œæœç´¢å’Œåˆ é™¤çš„æ—¶é—´å¤æ‚åº¦éƒ½ä¸BSTçš„é«˜åº¦hæˆæ­£ç›¸å…³ï¼Œ å› ä¸ºæœç´¢æ“ä½œæœ€åæƒ…å†µä¸‹éœ€è¦ä»æ ¹ä¸€ç›´æ¯”è¾ƒåˆ°æœ€æ·±çš„å¶å­ï¼Œ ä¹Ÿå°±æ˜¯hæ¬¡æ¯”è¾ƒã€‚

å³æ—¶é—´å¤æ‚åº¦ä¸º$O(h)$ï¼Œ è€Œhåœ¨æœ€å¥½æƒ…å†µä¸‹ä¸º$logN$çº§åˆ«ï¼Œ æœ€åæƒ…å†µä¸‹ä¸º$N$ï¼Œ å…¶ä¸­Nä¸ºæ ‘çš„ç»“ç‚¹æ•°é‡ã€‚

å½“BSTä¸ºä¸€æ¡é“¾æ—¶ï¼Œ æœç´¢å’Œæ’å…¥çš„æ—¶é—´å¤æ‚åº¦ä¸º$O(N)$ï¼Œ è¿™æ˜¯ä¸èƒ½æ¥å—çš„ã€‚

è€Œä¸”é€šè¿‡ä¸€ä¸ªæœ‰åºï¼ˆæˆ–å¤§è‡´æœ‰åºï¼‰çš„æ’å…¥é¡ºåºï¼Œ å°±èƒ½è½»æ˜“ä½¿BSTè¾¾åˆ°æ¯”è¾ƒåçš„æƒ…å†µã€‚

```
1, 2, 3, 4, 5, 6, 7
```

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD
A --> n1[NIL]
B --> n2[NIL]
C --> n3[NIL]
D --> n4[NIL]
E --> n5[NIL]
F --> n6[NIL]
A((1)) --> B((2))
B --> C((3))
C --> D((4))
D --> E((5))
E --> F((6))
F --> G((7))

classDef commonNode fill: black,color: white,stroke:none
class A,B,C,D,E,F,G,n1,n2,n3,n4,n5,n6 commonNode
```



## å¹³è¡¡æ ‘

å¹³è¡¡æ ‘æ˜¯æ”¹è¿›çš„äºŒå‰æœç´¢æ ‘, ä¸åŒçš„å¹³è¡¡æ ‘å…³äºå¹³è¡¡çš„å®šä¹‰æœ‰æ‰€ä¸åŒï¼Œ ä½†æ€»çš„æ¥è¯´æ˜¯åœ¨è¿½æ±‚: å„ä¸ªå¶å­çš„æ·±åº¦(ä»æ ¹åˆ°å„å¶å­ç»“ç‚¹çš„ç®€å•è·¯å¾„é•¿åº¦)è¶‹äºç›¸è¿‘/å¹³è¡¡ (è®©æ ‘çš„é«˜åº¦å°½é‡ä½ï¼Œ ä¸å‡ºç°æŸåˆ†æ”¯çš„æ·±åº¦è¿œè¿œçš„è¶…è¿‡å…¶ä»–åˆ†æ”¯çš„æƒ…å†µ)ã€‚

### è‡ªå¹³è¡¡æ ‘

è‡ªå¹³è¡¡æ ‘ï¼š åœ¨æ’å…¥ã€åˆ é™¤è¿‡åä¼šè‡ªåŠ¨è°ƒæ•´æ ‘ç»“æ„ä½¿å…¶æ»¡è¶³å¹³è¡¡å®šä¹‰çš„å¹³è¡¡æ ‘ã€‚

è‡ªå¹³è¡¡æ ‘ç›¸æ¯”äºäºŒå‰æœç´¢æ ‘è€Œè¨€ï¼Œ å¤šäº†æ’å…¥å’Œåˆ é™¤æ—¶çš„ç»´æŠ¤å¹³è¡¡æ“ä½œã€‚

å¹³è¡¡æ ‘ -> æ’å…¥æˆ–åˆ é™¤ç»“ç‚¹(é€šäºŒå‰æœç´¢æ ‘) -> å¹³è¡¡æ ‘å¤±è¡¡ -> ç»´æŠ¤å¹³è¡¡



### æ ‘çš„æ—‹è½¬

è€ƒè™‘å¦‚ä¸‹BST: 

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD
A((2)) --> B((1))
A --> C((4))
C --> F((3))
C --> D((5))
D --> n2[NIL]
D --> E((6))

classDef commonNode fill: black,color: white,stroke:none
class A,B,C,D,E,F,G,n1,n2 commonNode
```

å³åˆ†æ”¯æ·±åº¦æ˜æ˜¾çš„å¤§äºå·¦åˆ†æ”¯æ·±åº¦, æ­¤æ—¶æˆ‘ä»¬éœ€è¦è°ƒæ•´ï¼Œ ä½¿è¿™æ£µæ ‘æ›´å¹³è¡¡ã€ä¸”ä¸ç ´åBSTæ€§è´¨ã€‚

æ­¤æ—¶ä¾¿å¯ä»¥ä½¿ç”¨æ—‹è½¬, æ—‹è½¬æ“ä½œå›¾ç¤ºå¦‚ä¸‹: 

![bst-rotate](https://trudbot-md-img.oss-cn-shanghai.aliyuncs.com/bst-rotate.svg)

![æ ‘æ—‹è½¬çš„è¿‡ç¨‹æ¼”ç¤º](https://trudbot-md-img.oss-cn-shanghai.aliyuncs.com/Tree_rotation_animation_250x250.gif)

å·¦æ—‹ã€å³æ—‹çš„åå­—ç”±æ¥ä¸ºæ ¹èŠ‚ç‚¹çš„ç§»åŠ¨æ–¹å‘ï¼Œ å…·ä½“çš„: 

å·¦æ—‹: æ ¹ç»“ç‚¹ç§»åŠ¨åˆ°å·¦å­æ ‘ä¸Šï¼Œ æ ¹ç»“ç‚¹çš„å³å„¿å­æˆä¸ºäº†æ–°çš„æ ¹ç»“ç‚¹ã€‚

å³æ—‹: æ ¹ç»“ç‚¹ç§»åŠ¨åˆ°å³å­æ ‘ä¸Š,  æ ¹ç»“ç‚¹çš„å³å„¿å­æˆä¸ºäº†æ–°çš„æ ¹ç»“ç‚¹ã€‚

ä»ç»“æœä¸Šçœ‹: 

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD
subgraph after [å·¦æ—‹å]
a((4)) --> b((2))
b --> c((1))
a --> d((5))
b --> e((3))
d --> n1[NIL]
d --> f((6))
end
subgraph before [å·¦æ—‹å‰]
A((2)) --> B((1))
A --> C((4))
C --> F((3))
C --> D((5))
D --> n2[NIL]
D --> E((6))
end

classDef commonNode fill: black,color: white,stroke:none
class A,B,C,D,E,F,G,n1,n2,a,b,c,d,e,f commonNode
```



1. æ—‹è½¬æ“ä½œä¸ä¼šç ´åBSTæ€§è´¨(ä¸­åºä¸å˜)
2. **å·¦æ—‹æ“ä½œä½¿åŸå·¦å­æ ‘æ·±åº¦+1ï¼Œ åŸå³å„¿å­å³å­æ ‘æ·±åº¦-1ã€‚** å½±å“èŒƒå›´: (å·¦+1ã€å³å³-1)
3. **å³æ—‹æ“ä½œä½¿åŸå³å­æ ‘æ·±åº¦+1ï¼Œ åŸå·¦å„¿å­å·¦å­æ ‘æ·±åº¦-1ã€‚** å½±å“èŒƒå›´: (å³+1ã€å·¦å·¦-1)

æ—‹è½¬æ“ä½œæ˜¯å¤§å¤šæ•°å¹³è¡¡æ ‘ç»´æŠ¤å¹³è¡¡æ€§è´¨çš„æ“ä½œï¼Œ æ—¶é—´å¤æ‚åº¦ä¸º$O(1)$ã€‚

```typescript
/**
   * å·¦æ—‹æ“ä½œ
   * @param node å·¦æ—‹çš„å­æ ‘æ ¹ç»“ç‚¹, éœ€è¦ä¿è¯ä¸ä¸ºç©ºä¸”å³å­æ ‘ä¸ä¸ºç©º 
   * 
   *        g           p
   *       / \         / \
   *      u   p  -->  g   n
   *         / \     / \    
   *        m   n   u   m     
   */
rotateLeft(node: Node<K, V>) {
  const parent = node.parent;
  const direction = node.direction();
  const successor = node.right!;
  // å·¦æ—‹æ ¸å¿ƒæ“ä½œ, æ ¹å˜ä¸ºsuccessorçš„å·¦å­æ ‘, successorå˜ä¸ºæ ¹
  node.setRightChild(successor.left);
  successor.setLeftChild(node);

  // nodeçš„ä½ç½®ä¸ºsuccessorå–ä»£, éœ€è¦æ›´æ–°nodeçš„çˆ¶ç»“ç‚¹ä¸successorçš„å…³ç³»
  switch (direction) {
    case DIRECTION.LEFT:
      parent!.setLeftChild(successor);
      break;
    case DIRECTION.RIGHT:
      parent!.setRightChild(successor);
      break;
    case DIRECTION.ROOT:
      this.root = successor;
      break;
  }
}
```



### AVLæ ‘

AVLæ ‘çš„å¹³è¡¡å®šä¹‰:  å¯¹äºæ ‘ä¸­ä»»æ„ä¸€ä¸ªç»“ç‚¹, å…¶å·¦å­æ ‘æ·±åº¦å’Œå³å­æ ‘æ·±åº¦çš„å·®å€¼ç»å¯¹å€¼**ä¸å¤§äº** $1$.

å¹³è¡¡å› å­ï¼šå³å­æ ‘é«˜åº¦ - å·¦å­æ ‘é«˜åº¦

> AVLæ ‘åå­—çš„æ¥æºä¸ºå®ƒçš„ä¸¤ä¸ªå‘æ˜è€…åå­—åˆå¹¶:  [Georgy Adelson-Velsky](https://en.wikipedia.org/wiki/Georgy_Adelson-Velsky) and [Evgenii Landis](https://en.wikipedia.org/wiki/Evgenii_Landis)

AVLæ ‘çš„æ€§è´¨ä¿è¯äº†AVLæ ‘çš„é«˜åº¦ä¸º$logN$çº§åˆ«, å› æ­¤ä¹Ÿè¢«ç§°ä¸ºã€é«˜åº¦å¹³è¡¡æ ‘ã€ã€‚

#### AVLæ ‘çš„ç»´æŠ¤æ“ä½œ

å…ˆè¯´æ˜å‡ ä¸ªäº‹å®

1. æ’å…¥/åˆ é™¤ç»“ç‚¹åï¼Œ å¯èƒ½å¯¼è‡´åŒ…å«è¯¥ç»“ç‚¹çš„æ‰€æœ‰å­æ ‘æ ‘å¤±è¡¡
2. ç”±äºæ˜¯åœ¨AVLæ ‘ä¸Šæ’å…¥/åˆ é™¤äº†ä¸€ä¸ªç»“ç‚¹ï¼Œ æ‰€ä»¥è‹¥ä¸€é¢—å­æ ‘å¤±è¡¡, å…¶$|å¹³è¡¡å› å­|$åªèƒ½ä¸º2

åœ¨AVLæ ‘æ’å…¥/åˆ é™¤å, æˆ‘ä»¬å°†ä»æ’å…¥/åˆ é™¤çš„ç»“ç‚¹çš„çˆ¶ç»“ç‚¹å¼€å§‹å‘ä¸Š(è¿™æ ·å°±èƒ½éå†åˆ°åŒ…å«è¯¥ç»“ç‚¹çš„æ‰€æœ‰æ ‘)ï¼Œ åˆ¤æ–­å½“å‰å½“å‰èŠ‚ç‚¹çš„å¹³è¡¡å› å­æ˜¯å¦å¤±è¡¡ï¼Œ è‹¥å¤±è¡¡åˆ™å¯¹å½“å‰ç»“ç‚¹è¿›è¡Œç»´æŠ¤ã€‚

ç»´æŠ¤æ“ä½œå¯ä»¥åˆ†ç±»è®¨è®ºï¼Œ ä¸€äº›çº¦å®šå¦‚ä¸‹:

1. æ‰€ç»˜å›¾ä¸­æ ¹ç»“ç‚¹ï¼ˆNï¼‰ä¸ºå¤±è¡¡çš„ç»“ç‚¹(å³h(L) - h(R) == 2 / -2)
2. Lä¸ºNçš„å·¦å­©å­ã€LLä¸ºLçš„å·¦å­©å­(Rã€RRåŒç†)
3. ç»“ç‚¹åç§°åç”¨æ‹¬å·æ³¨æ˜é«˜åº¦
4. ã€åœ†ã€ä¸ºå…·ä½“ç»“ç‚¹ï¼Œ è€Œæ¢¯å½¢ä»£æŒ‡ä¸€é¢—æ ‘

ä¸€äº›äº‹å®å¦‚ä¸‹:

1. ç”±äºæ˜¯è‡ªåº•å‘ä¸Šè¿›è¡Œç»´æŠ¤ï¼Œ å½“å‰è®¨è®ºçš„æ˜¯ç»“ç‚¹N, é‚£ä¹ˆLæ‰€åœ¨å­æ ‘å’ŒRæ‰€åœ¨å­æ ‘å·²ç»ç»´æŠ¤å®Œæˆç¬¦åˆAVLæ ‘æ€§è´¨
2. è¢«æ’å…¥/åˆ é™¤ç»“ç‚¹çš„çˆ·çˆ·ç»“ç‚¹å¼€å§‹ï¼Œ æ‰å¯èƒ½å‡ºç°å¤±è¡¡

##### LL/RRå‹å¤±è¡¡

ä»¥LLå‹å¤±è¡¡ä¸¾ä¾‹, è¿™æ˜¯ä¸€é¢—LLå‹å¤±è¡¡çš„æ ‘, æ»¡è¶³å¦‚ä¸‹ç‰¹å¾:

1. Nçš„å·¦å­æ ‘æ¯”å³å­æ ‘é«˜
1. Lçš„å·¦å­æ ‘æ¯”å³å­æ ‘é«˜ --> $H(LL) \ge H(LR)$

è®¾$H(R) = h$ï¼Œ åˆ™æœ‰

1. $H(L) = h + 2$
2. $H(LL) = h + 1$
3. $h \le H(LR) \le h + 1$

æ­¤æ—¶Lå’ŒRçš„é«˜åº¦å·®å¯ä»¥çœ‹æˆæ˜¯LLå’ŒRçš„é«˜åº¦å·®ï¼Œ è€Œå³æ—‹çš„æ•ˆæœä¸º (å³+1ã€å·¦å·¦-1)æ»¡è¶³æ­¤æƒ…å†µï¼Œ è¿›è¡Œä¸€æ¬¡å³æ—‹å³å¯ã€‚

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD
subgraph gb [å³æ—‹å]
A --> D[/"LL (h + 1)"\]
A((L)) --> B(("N (h+1 / h+2)"))
B --> E[/"LR (h / h+1)"\]
B --> C[/"R (h)"\]
end
subgraph ga [å¤±è¡¡]
a(("N")) --> b(("L (h+2)"))
a --> c[/"R (h)"\]
b --> d[/"LL (h+1)"\]
b --> e[/"LR (h / h+1)"\]
end

classDef commonNode fill: black,color: white,stroke:none
class A,B,C,D,E,F,G,H,I,J,K,L,M,N,n1,n2,n3,n4,n5,n6,n7,n8,a,b,c,d,e,f,g,h,i,j,k,l,m,n commonNode
```

å³æ—‹åLLã€LRã€Rçš„é«˜åº¦å¹¶ä¸ä¼šå˜åŒ–ï¼Œ æ­¤æ—¶æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡ºNçš„é«˜åº¦å˜ä¸ºäº†$h + 1 \le H(N) \le h+2$, Nå­æ ‘å’ŒLå­æ ‘éƒ½æ»¡è¶³äº†AVLæ ‘æ€§è´¨ï¼Œ ä¿®å¤å®Œæˆ!

##### LR/RLå‹å¤±è¡¡

åŒæ ·åªä»¥LRå‹ä¸¾ä¾‹:

è®¾$H(R) = h$, åˆ™æœ‰

1. $H(L) = h + 2$;
2. $H(LL) = h$
3. $H(LR) = h + 1$
4. $h - 1 \le H(LRL) \le h$
5. $h - 1 \le H(LRR) \le h$

$LR/RL$å‹çš„å¤±è¡¡å¯ä»¥é€šè¿‡ Lå·¦æ—‹ -> Nå³æ—‹ æ¥è§£å†³ï¼Œ å¦‚ä¸‹å›¾

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD
  subgraph gc [Lå·¦æ—‹ + N å³æ—‹å]
  k(("LR"))
  i(("L (h+1)"))
  h(("N (h+1)"))
  j[/"LL (h)"\]
  l[/"R (h)"\]
  m[/"LRL (h / h-1)"\]
  n[/"LRR (h / h-1)"\]
	
	k --> i
  k --> h
  i --> j
  i --> m
  h --> n
  h --> l
  end

  subgraph gb [Lå·¦æ—‹å]
  A(("N"))
  B(("L (h + 1)"))
  D[/"LL (h)"\]
  E(("LR (h+2)"))
  C[/"R (h)"\]
  F[/"LRL (h / h-1)"\]
  G[/"LRR (h / h-1)"\]
  A --> E
  A --> C
  E --> B
  B --> D
  B --> F
  E --> G
  end

  subgraph ga [å¤±è¡¡]
  a(("N")) --> b(("L (h+2)"))
  a --> c[/"R (h)"\]
  b --> d[/"LL (h)"\]
  b --> e(("LR (h+1)"))
  e --> f[/"LRL (h / h-1)"\]
  e --> g[/"LRR (h / h-1)"\]
  end


classDef commonNode fill: black,color: white,stroke:none
class A,B,C,D,E,F,G,H,I,J,K,L,M,N,n1,n2,n3,n4,n5,n6,n7,n8,a,b,c,d,e,f,g,h,i,j,k,l,m,n commonNode
```

ä»ç»“æœä¸Šçœ‹, æ“ä½œå®Œæˆå$H(L) = h + 1, H(N) = h + 1$ï¼Œ ç¬¦åˆAVLæ ‘æ€§è´¨ã€‚

> Todo: æ˜¯æ€ä¹ˆæƒ³åˆ°ç”¨å…ˆåä¸¤æ¬¡ä¸åŒçš„æ—‹è½¬æ¥ä¿®å¤æ€§è´¨çš„?æ˜¯å¦è•´å«ç€æ•°å­¦åŸç†



### Bæ ‘

![img](https://trudbot-md-img.oss-cn-shanghai.aliyuncs.com/400px-B-tree.svg.png)

Bæ ‘æ˜¯ä¸€ç§è‡ªå¹³è¡¡å¤šå‰æ ‘ã€‚

ä¸€é¢— $m$é˜¶Bæ ‘æ»¡è¶³å¦‚ä¸‹æ€§è´¨:

1. æ¯ä¸ªç»“ç‚¹æœ€å¤šæœ‰$m$ä¸ªå­ç»“ç‚¹
2. æ¯ä¸ªéå¶å­ç»“ç‚¹(é™¤äº†æ ¹)è‡³å°‘æœ‰$\lceil m / 2 \rceil$
3. å¦‚æœæ ¹èŠ‚ç‚¹ä¸æ˜¯å¶å­èŠ‚ç‚¹ï¼Œé‚£ä¹ˆå®ƒè‡³å°‘æœ‰ä¸¤ä¸ªå­èŠ‚ç‚¹ã€‚
4. è‹¥ä¸€ä¸ªç»“ç‚¹æœ‰æœ‰kä¸ªå­ç»“ç‚¹ï¼Œ é‚£ä¹ˆè¯¥ç»“ç‚¹æœ‰k-1ä¸ªé”®ï¼Œ åä¹‹äº¦ç„¶ï¼› 
5. æ¯ä¸ªç»“ç‚¹çš„é”®å€¼å‡åºæ’åˆ—ï¼Œ ä¸”nçš„ç¬¬kä¸ªå­èŠ‚ç‚¹çš„æ‰€æœ‰é”®å€¼æ»¡è¶³å°äºnçš„ç¬¬kä¸ªé”®å€¼ã€å¤§äºnçš„ç¬¬k-1ä¸ªé”®å€¼
6. æ‰€æœ‰çš„å¶å­èŠ‚ç‚¹éƒ½åœ¨åŒä¸€å±‚ã€‚



### çº¢é»‘æ ‘

çº¢é»‘æ ‘æ˜¯æ»¡è¶³å¦‚ä¸‹æ€§è´¨çš„äºŒå‰æœç´¢æ ‘:

1. æ¯ä¸€ä¸ªç»“ç‚¹è¦ä¹ˆæ˜¯çº¢è‰²ï¼Œ è¦ä¹ˆæ˜¯é»‘è‰²
2. çº¢è‰²ç»“ç‚¹çš„å­©å­å¿…é¡»ä¸ºé»‘è‰²
3. å¯¹äºçº¢é»‘æ ‘ä¸­ä»»æ„ä¸€ä¸ªç»“ç‚¹ï¼Œ å®ƒåˆ°NIL(null)ç»“ç‚¹çš„æ¯ä¸€æ¡ç®€å•è·¯å¾„å¿…é¡»åŒ…å«ç›¸åŒæ•°é‡çš„é»‘è‰²ç»“ç‚¹

é™¤æ­¤ä¹‹å¤–ï¼Œ è¿˜æœ‰ä¸¤æ¡è¢«å¹¿æ³›ä½¿ç”¨çš„çº¢é»‘æ ‘çš„æ€§è´¨ 

4. æ ¹ç»“ç‚¹æ˜¯é»‘è‰²
5. NIL(null)ç»“ç‚¹è¢«è®¤ä¸ºæ˜¯é»‘è‰²

è¿™ä¸¤æ¡æ€§è´¨å¯¹äºçº¢é»‘æ ‘æ¥è¯´å¹¶ä¸æ˜¯å¿…é¡»çš„ï¼Œ ä½†èƒ½ä¾¿åˆ©å¯¹çº¢é»‘æ ‘çš„ç®—æ³•å½’çº³ï¼Œ æˆ‘ä»¬å§‘ä¸”ä¹Ÿè®¤ä¸ºè¿™æ˜¯çº¢é»‘æ ‘å¿…é¡»æ»¡è¶³çš„æ€§è´¨ã€‚



çº¢é»‘æ ‘æœ€åˆæ˜¯ä»Bæ ‘ä¸­æ¨å¯¼å‡ºæ¥çš„,  äº‹å®ä¸Šçº¢é»‘æ ‘å¯ä»¥ç­‰ä»·çš„çœ‹åšå››é˜¶Bæ ‘ã€‚

#### çº¢é»‘æ ‘ä¸4é˜¶Bæ ‘

ä»¥ä¸‹å¼•ç”¨è‡ª: [çº¢é»‘æ ‘ | Jasonâ€˜s Blog (jasonxqh.github.io)](https://jasonxqh.github.io/2020/11/03/çº¢é»‘æ ‘/)

> çº¢é»‘æ ‘å’Œ4é˜¶Bæ ‘ä¹‹é—´å­˜åœ¨ç­‰ä»·å…³ç³»ã€‚å¦‚å“¦ä»çº¢é»‘æ ‘çš„æ ‘æ ¹å¼€å§‹ï¼Œè‡ªé¡¶å‘ä¸‹é€å±‚æ£€æŸ¥ï¼Œå¦‚æœé‡åˆ°çº¢ç»“ç‚¹ï¼Œåˆ™å°†è¯¥èŠ‚ç‚¹å‹ç¼©åˆ°çˆ¶èŠ‚ç‚¹ä¸€ä¾§ï¼›å¦‚æœé‡åˆ°é»‘èŠ‚ç‚¹ï¼Œåˆ™ä¿ç•™ã€‚å› ä¸º**çº¢ç»“ç‚¹å¯¹é»‘é«˜æ²¡æœ‰è´¡çŒ®**ï¼Œè€Œé»‘ç»“ç‚¹å¯¹é»‘é«˜æœ‰è´¡çŒ®ã€‚
>
> çº¢é»‘æ ‘ä¸4é˜¶Bæ ‘çš„4ç§ç­‰ä»·æ–¹å¼ï¼š
>
> 1ï¼‰ ä¸¤ä¸ªé»‘å­©å­(é»‘é»‘)ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š
>
> ![img](https://trudbot-md-img.oss-cn-shanghai.aliyuncs.com/2.png)
>
> 2ï¼‰å·¦é»‘å³çº¢(é»‘çº¢)ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š
>
> ![img](https://trudbot-md-img.oss-cn-shanghai.aliyuncs.com/3.png)
>
> \3) å·¦çº¢å³é»‘(çº¢é»‘) ï¼Œå¦‚å›¾æ‰€ç¤ºï¼š
>
> ![img](https://trudbot-md-img.oss-cn-shanghai.aliyuncs.com/4.png)
>
> 4ï¼‰ä¸¤ä¸ªçº¢å­©å­(çº¢çº¢)ï¼Œå¦‚å›¾æ‰€ç¤º
>
> ![img](https://trudbot-md-img.oss-cn-shanghai.aliyuncs.com/5.png)
>
> ä»çº¢é»‘æ ‘ä¸4é˜¶Bæ ‘çš„ç­‰ä»·å…³ç³»å¯ä»¥çœ‹å‡ºï¼Œ4é˜¶Bæ ‘ä¸­çš„ç»“ç‚¹ä¸­å¿…ç„¶å«æœ‰ä¸€ä¸ªé»‘èŠ‚ç‚¹ã€‚è€Œä¸”ä¸ä¼šå‡ºç°çº¢è‰²çš„çˆ¶äº²ã€‚æ¯ä¸€ä¸ªç»“ç‚¹æœ€å¤šåŒ…å«ä¸‰ä¸ªå…³é”®å­—ï¼šå¦‚æœåŒ…å«2ä¸ªçº¢å…³é”®å­—ï¼Œåˆ™é»‘å…³é”®å­—å¿…ç„¶åœ¨ä¸­é—´ä½ç½®ã€‚
>
> æˆ‘ä»¬å¯ä»¥å°è¯•å°†è¿™ä¸€æ£µçº¢é»‘æ ‘è¿›è¡Œå‹ç¼©ã€‚
>
> ![img](https://trudbot-md-img.oss-cn-shanghai.aliyuncs.com/1.png)
>
> æœ€åå¯ä»¥å¾—åˆ°è¿™æ ·ä¸€æ£µ4é˜¶çš„Bæ ‘
>
> ![img](https://trudbot-md-img.oss-cn-shanghai.aliyuncs.com/1.jpg)
>
> é‚£ä¹ˆæ—¢ç„¶çº¢é»‘æ ‘å’Œ4é˜¶Bæ ‘æ˜¯å¯ä»¥äº’ç›¸è½¬åŒ–çš„ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜è¦ç”¨çº¢é»‘æ ‘å‘¢ï¼Ÿè¿™æ˜¯å› ä¸ºçº¢é»‘æ ‘å’ŒBæ ‘å¤„ç†çš„æ–¹å‘ä¸åŒã€‚Bæ ‘ä¸»è¦ç”¨äºå†…å¤–å­˜çš„è®¿é—®ï¼Œæ—‹è½¬ä¸æ˜¯å¾ˆå®¹æ˜“ï¼Œä½†æ˜¯çº¢é»‘æ ‘çš„æ—‹è½¬è°ƒå¹³è¡¡æ¯”è¾ƒæ–¹ä¾¿



#### æ’å…¥

çº¢é»‘æ ‘çš„æ’å…¥ï¼Œ é¦–å…ˆå°†æ’å…¥ç»“ç‚¹æŒ‰ç…§BSTçš„è§„åˆ™æ’å…¥æ ‘ä¸­ï¼Œ ç„¶ååˆ¤æ–­æ˜¯å¦ä¼šå¯¼è‡´å¤±è¡¡ï¼Œ æ ¹æ®å…¶æƒ…å†µä½¿ç”¨ä¸åŒç­–ç•¥è¿›è¡Œä¿®æ­£ã€‚

ä¸€äº›çº¦å®š:

1. Nä¸ºæ’å…¥çš„ç»“ç‚¹
2. Pä¸º`parent`çˆ¶äº²ç»“ç‚¹
3. Gä¸º`grandparent`çˆ·çˆ·ç»“ç‚¹
4. Uä¸º`uncle`å”å”ç»“ç‚¹
5. åœ†å½¢ç»“ç‚¹ä¸ºå…·ä½“çš„èŠ‚ç‚¹ï¼› æ¢¯å½¢ç»“ç‚¹ä»£è¡¨ä¸€é¢—æ— éœ€é€éœ²ç»†èŠ‚çš„å­æ ‘
6. ç»“ç‚¹åç§°åå¦‚æœ‰æ‹¬å·ï¼Œ åˆ™è¡¨ç¤ºè¯¥èŠ‚ç‚¹åˆ°å¶å­ç»“ç‚¹çš„é»‘è‰²æ•°é‡

ä¸€äº›äº‹å®:

1. æ’å…¥çš„ç»“ç‚¹å¿…ç„¶ä¸ºçº¢è‰²ç»“ç‚¹ã€‚ å› ä¸ºè¢«æ’å…¥çš„æ ‘å·²ç»æ»¡è¶³çº¢é»‘æ ‘æ€§è´¨ï¼Œ æ­¤æ—¶å¦‚æœæ’å…¥ä¸€ä¸ªé»‘è‰²ç»“ç‚¹ï¼Œ é‚£ä¹ˆå¿…ç„¶ä¼šè®©æŸæ¡è·¯å¾„çš„é»‘è‰²æ•°é‡+1ï¼Œ é€ æˆå¤±è¡¡(é™¤ç©ºæ ‘æƒ…å†µ)
2. ç©ºæ ‘æƒ…å†µä¸‹ï¼Œ å°†æ’å…¥ç»“ç‚¹æ›´æ”¹ä¸ºé»‘è‰²å³å¯
3. æ’å…¥ç»“ç‚¹çš„çˆ¶äº²ä¸ºé»‘è‰²æ—¶ï¼Œ ä¸ä¼šç ´åçº¢é»‘æ ‘æ€§è´¨ã€‚ 

æ’é™¤ä»¥ä¸Šæƒ…å†µæ—¶ï¼Œ å¿…ç„¶æ»¡è¶³:

1. æ’å…¥ç»“ç‚¹æœ‰çˆ¶ç»“ç‚¹ä¸”çˆ¶ç»“ç‚¹ä¸ºçº¢è‰²
2.  æ’å…¥ç»“ç‚¹æœ‰çˆ·çˆ·ä¸”çˆ·çˆ·ä¸ºé»‘è‰²

æ¥ä¸‹æ¥æˆ‘ä»¬å°†ä»¥`uncle`ä¸º çº¢/é»‘ æ—¶åˆ†ç±»è®¨è®ºå‰©ä¸‹çš„å¤±è¡¡æƒ…å†µã€‚

##### uncleä¸ºçº¢è‰²æ—¶

æ­¤æ—¶æˆ‘ä»¬å°†GæŸ“çº¢ï¼Œ På’ŒUæŸ“é»‘ï¼Œæ­¤æ—¶Gå­æ ‘å·²ç»ä¿®æ­£äº†æ€§è´¨ï¼Œ ä½†Gå˜çº¢å¯èƒ½å¯¼è‡´æ›´ä¸Šå±‚çš„å¤±è¡¡ï¼Œ å› æ­¤æˆ‘ä»¬å°†Gå½“æˆåˆšæ’å…¥çš„ç»“ç‚¹ï¼Œ é€’å½’åœ°ç»´æŠ¤ã€‚ 

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD
subgraph æ¢è‰²å
g((G))
p((P))
u((U))
n((N))
pr[/ \]
nl[/ \]
nr[/ \]
ul[/ \]
ur[/ \]

g --> p
g --> u
p --> n
p --> pr
n --> nl
n --> nr
u --> ul
u --> ur
end
subgraph å¤±è¡¡çŠ¶æ€
G((G))
P((P))
U((U))
N((N))
PR[/ \]
NL[/ \]
NR[/ \]
UL[/ \]
UR[/ \]

G --> P
G --> U
P --> N
P --> PR
N --> NL
N --> NR
U --> UL
U --> UR
end

classDef tree fill: white, color: black, stroke: black
classDef blackNode fill: black,color: white,stroke:none
classDef redNode fill: red,color: white,stroke: none
class G,p,u blackNode
class P,N,U,g,n redNode
class PR,NL,NR,UL,UR,pr,nl,nr,ul,ur tree
```

```typescript
if (uncle && uncle.isRed()) {
  uncle.setBlack();
  parent.setBlack();
  gparent.setRed();
  this.maintainAfterInsert(gparent);
  return;
}
```



##### uncleä¸ºé»‘è‰²æ—¶: LL/RRå‹å¤±è¡¡

ä»¥`LL`å‹å¤±è¡¡ä¸¾ä¾‹(Pä¸ºGçš„å·¦å„¿å­ï¼Œ Nä¸ºPçš„å·¦å„¿å­)

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD
G((G))
P((P))
U((U))
N((N))
PR[/ \]
NL[/ \]
NR[/ \]
UL[/ \]
UR[/ \]

G --> P
G --> U
P --> N
P --> PR
N --> NL
N --> NR
U --> UL
U --> UR
classDef tree fill: white, color: black, stroke: black
classDef blackNode fill: black,color: white,stroke:none
classDef redNode fill: red,color: white,stroke: none
class G,U blackNode
class P,N redNode
class PR,NL,NR,UL,UR tree
```

æˆ‘ä»¬ä»4é˜¶Bæ ‘çš„è§’åº¦ä¸Šçœ‹(Bæ ‘çš„å›¾éå¸¸é‡è¦éå¸¸å¥½):

![img](https://trudbot-md-img.oss-cn-shanghai.aliyuncs.com/6.png)

åœ¨ä¸ç ´åæœç´¢æ ‘æ€§è´¨çš„æƒ…å†µä¸‹ï¼Œ å¦‚ä¸ŠBæ ‘åªéœ€äº¤æ¢pã€gé¢œè‰²å³å¯ã€‚

> å›æ”¶å‰æ–‡çš„ä¸€äº›ç–‘é—®:
>
> **ä¸ºä»€ä¹ˆè¦åˆ†uncleä¸ºçº¢è¿˜æ˜¯é»‘ï¼Ÿ**
>
> ç”±ä¸Šå›¾å¯ä»¥å‘ç°ï¼Œ å½“uncleä¸ºçº¢æ—¶ï¼Œ x-p-gè¿™ä¸€å±‚è¿˜è¦åŠ ä¸€ä¸ªuå˜æˆ x-p-g-u
>
> ![image-20240624221100810](https://trudbot-md-img.oss-cn-shanghai.aliyuncs.com/image-20240624221100810.png)
>
> 4é˜¶Bæ ‘çš„ç»“ç‚¹é”®å€¼æ•°è¶…è¿‡äº†3ï¼Œ æ­¤æ—¶å‘ç”Ÿä¸Šæº¢ï¼Œ éœ€è¦è¿›è¡Œåˆ†è£‚æ“ä½œï¼Œ å¦‚ä¸Šå›¾ã€‚
>
> gå˜ä¸ºçº¢è‰²å, gçš„ä¸Šå±‚å¯èƒ½å¤±è¡¡ï¼Œ å› æ­¤éœ€è¦é€’å½’å‘ä¸Šè§£å†³ã€‚
>
> **å¶å­ç»“ç‚¹ä¸ºä»€ä¹ˆè¦è®¤ä¸ºæ˜¯é»‘è‰²?**
>
> åœ¨è§£å†³çº¢é»‘æ ‘çš„å¤±è¡¡è¿‡ç¨‹ä¸­ï¼Œ ç»å¸¸é‡åˆ°éœ€è¦æ ¹æ®æŸä¸ªç»“ç‚¹çš„é¢œè‰²åˆ†ç±»è®¨è®ºçš„æƒ…å†µ, ä½†æˆ‘ä»¬å‘ç°ï¼Œè®¨è®ºç»“ç‚¹çš„é¢œè‰²å…¶å®åªæ˜¯åœ¨åŒºåˆ†  çº¢è‰²(Bæ ‘å½¢å¼ä¸­ä¼šå‹ç¼©åˆ°çˆ¶ç»“ç‚¹) / éçº¢è‰²(ä¸ä¼šåœ¨çˆ¶ç»“ç‚¹ä¸­) ä¸¤ç§æƒ…å†µã€‚
>
> æ‰€ä»¥æ²¡æœ‰å¿…è¦æ¯æ¬¡éƒ½åŠ ä¸€æ¡: å¦‚æœä¸ºç©ºï¼Œ å¦‚ä½•å¦‚ä½•ã€‚



è€Œç”±äº4é˜¶Bæ ‘å½¢å¼ä¸­é»‘è‰²ä¸ºæ ¹ç»“ç‚¹ï¼Œ æ¢æˆäºŒå‰æ ‘æ“ä½œéœ€è¦åˆ†ä¸ºä¸¤æ­¥:

1. åŸºäºgè¿›è¡Œå³æ—‹
2. å°†pæŸ“é»‘ï¼Œ gæŸ“çº¢

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD
subgraph å³æ—‹ + æ¢è‰²å
p((P))
u((U))
n((N))
g((G))
pr[/ \]
nl[/ \]
nr[/ \]
ul[/ \]
ur[/ \]

p --> n
n --> nl
n --> nr
p --> g
g --> pr
g --> u
u --> ul
u --> ur
end
subgraph å¤±è¡¡çŠ¶æ€
G((G))
P((P))
U((U))
N((N))
PR[/ \]
NL[/ \]
NR[/ \]
UL[/ \]
UR[/ \]

G --> P
G --> U
P --> N
P --> PR
N --> NL
N --> NR
U --> UL
U --> UR
end

classDef tree fill: white, color: black, stroke: black
classDef blackNode fill: black,color: white,stroke:none
classDef redNode fill: red,color: white,stroke: none
class G,p,u blackNode
class P,N,U,g,n redNode
class PR,NL,NR,UL,UR,pr,nl,nr,ul,ur tree
```

```typescript
if (parent.direction() === node.direction()) {

  if (node.direction() === DIRECTION.LEFT) {
    // LLå‹å¤±è¡¡
    this.rotateRight(gparent);
  } else {
    // RRå‹å¤±è¡¡
    this.rotateLeft(gparent);
  }

  parent.setBlack();
  gparent.setRed();
}
```

##### uncleä¸ºé»‘è‰²æ—¶: LR/RLå‹å¤±è¡¡

ä»¥LRå‹å¤±è¡¡ä¸¾ä¾‹(Pä¸ºGçš„å·¦å„¿å­ï¼Œ Nä¸ºPçš„å³å„¿å­):

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD
G((G))
P((P))
U((U))
PL[/ \]
N((N))
NL[/ \]
NR[/ \]
UL[/ \]
UR[/ \]

G --> P
G --> U
P --> PL
P --> N
N --> NL
N --> NR
U --> UL
U --> UR
classDef tree fill: white, color: black, stroke: black
classDef blackNode fill: black,color: white,stroke:none
classDef redNode fill: red,color: white,stroke: none
class G,U blackNode
class P,N redNode
class PL,NL,NR,UL,UR tree
```

åŒæ ·è½¬åŒ–ä¸º4é˜¶Bæ ‘å½¢å¼:



![img](https://trudbot-md-img.oss-cn-shanghai.aliyuncs.com/8.png)



åŒæ ·æ˜¯å‡ºç°äº†è¿ç»­çš„çº¢è‰²ï¼Œ åŒæ ·æŠŠä¸­é—´æŸ“é»‘ï¼Œ ä½†LRè¦è¿›è¡Œçš„æ“ä½œè¦å¤šä¸€ç‚¹ï¼š 

1. åŸºäºPè¿›è¡Œå·¦æ—‹

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD
subgraph På·¦æ—‹å
g((G))
p((P))
n((N))
u((U))
pl[/ PL \]
nl[/ NL \]
nr[/ NR \]
ul[/ UL \]
ur[/ UR \]

g --> n
g --> u
n --> p
n --> nr
p --> pl
p --> nl
u --> ul
u --> ur
end
subgraph å¤±è¡¡çŠ¶æ€
G((G))
P((P))
U((U))
PL[/ PL \]
N((N))
NL[/ NL \]
NR[/ NR \]
UL[/ UL \]
UR[/ UR \]

G --> P
G --> U
P --> PL
P --> N
N --> NL
N --> NR
U --> UL
U --> UR
end
classDef tree fill: white, color: black, stroke: black
classDef blackNode fill: black,color: white,stroke:none
classDef redNode fill: red,color: white,stroke: none
class G,U,g,u blackNode
class P,N,p,n redNode
class PL,NL,NR,UL,UR,pl,nl,nr,ul,ur tree
```

2. åŸºäºGå³æ—‹
3. å°†NæŸ“é»‘, å°†GæŸ“çº¢

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD

subgraph "På·¦æ—‹ + Gå³æ—‹ + Nã€Gæ¢è‰²å"
P((P))
G((G))
N((N))
U((U))
PL[/ PL \]
NL[/ NL \]
NR[/ NR \]
UL[/ UL \]
UR[/ UR \]

N --> P
P --> PL
P --> NL
N --> G --> NR
G --> U
U --> UL
U --> UR
end
subgraph På·¦æ—‹å
g((G))
p((P))
n((N))
u((U))
pl[/ PL \]
nl[/ NL \]
nr[/ NR \]
ul[/ UL \]
ur[/ UR \]

g --> n
g --> u
n --> p
n --> nr
p --> pl
p --> nl
u --> ul
u --> ur
end

classDef tree fill: white, color: black, stroke: black
classDef blackNode fill: black,color: white,stroke:none
classDef redNode fill: red,color: white,stroke: none
class G,U,g,u,N blackNode
class P,p,n,G redNode
class PL,NL,NR,UL,UR,pl,nl,nr,ul,ur tree
```

#### åˆ é™¤

åœ¨åˆ é™¤è¿‡ç¨‹ä¸­ï¼Œ æˆ‘ä»¬ç°å¯¹æ¬²åˆ é™¤çš„é”®å€¼è¿›è¡Œæœç´¢ï¼Œ åœ¨æœç´¢åˆ°çš„èŠ‚ç‚¹ä¸ºNçš„æƒ…å†µä¸‹:

> 1. è‹¥Næœ‰ä¸¤ä¸ªå­©å­ï¼Œ å°†å…¶å‰é©±(æˆ–åç»§)ç»“ç‚¹çš„é”®ä¸å€¼ä¸Næ›¿æ¢(ä¸æ›¿æ¢é¢œè‰²)ï¼Œæ­¤æ—¶è¦åˆ é™¤çš„ç»“ç‚¹æ”¹ä¸ºäº†å‰é©±(æˆ–åç»§)ç»“ç‚¹

ç»è¿‡äº†`(1)`ï¼Œ æˆ‘ä»¬ç¡®è®¤äº†è¦åˆ é™¤çš„ç»“ç‚¹ç©¶ç«Ÿæ˜¯å“ªä¸ª, æ¥ä¸‹æ¥ä»¥Nä»£æŒ‡è¦åˆ é™¤çš„ç»“ç‚¹, æ­¤æ—¶æˆ‘ä»¬ç»§ç»­åˆ†æƒ…å†µè®¨è®º: 

> 2. è‹¥Nä¸ºæ ‘ä¸­å”¯ä¸€çš„ç»“ç‚¹ï¼Œ ç›´æ¥åˆ é™¤å³å¯

> 3. è‹¥Næœ‰å·¦/å³å­©å­, åˆ é™¤Nåç”¨å®ƒçš„å·¦/å³å­©å­ä»£æ›¿Nçš„ä½ç½®(ç”±äºå‰é©±æˆ–åç»§çš„æ€§è´¨, Nä¸å¯èƒ½æœ‰ä¸¤ä¸ªå­©å­)

`(2)`ã€`(3)ç­–ç•¥ä¿è¯äº†åˆ é™¤åBSTçš„æ€§è´¨æ­£ç¡®,  æ¥ä¸‹æ¥ä»çº¢é»‘æ ‘æ€§è´¨ä¸Šè€ƒè™‘åˆ é™¤åå¦‚ä½•ä¿®æ­£: 

> 4. è‹¥Nä¸ºçº¢è‰², ä¸ä¼šç ´åçº¢é»‘æ ‘æ€§è´¨ï¼Œ æ— éœ€ç»´æŠ¤

å½“åˆ é™¤ä¸€ä¸ªçº¢è‰²ç»“ç‚¹æ—¶, å¹¶ä¸ä¼šæ”¹å˜è·¯å¾„ä¸­é»‘è‰²ç»“ç‚¹çš„æ•°é‡ï¼› åŒæ—¶é¡¶æ›¿å®ƒä½ç½®çš„å·¦/å³å­©å­ å’Œ çˆ¶äº²(å¦‚æœå­˜åœ¨) å¿…ç„¶æ˜¯é»‘è‰²ç»“ç‚¹, ä¸ä¼šç ´å*çº¢è‰²ç»“ç‚¹çš„å­©å­å¿…é¡»ä¸ºé»‘è‰²*çš„æ€§è´¨

> 5. è‹¥Næœ‰å­©å­
>     1. Nçš„å­©å­å¿…ç„¶ä¸ºçº¢è‰²ï¼Œ å¦åˆ™Nå­æ ‘ä¸æ»¡è¶³çº¢é»‘æ ‘æ€§è´¨

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD
subgraph åˆ é™¤Nå
p((P))
pl[/"PL(k)"\]
r(("R(k-1)"))
rl[NIL]
rr[NIL]
p --> pl
p --> r
r --> rl
r --> rr
end
subgraph åˆ é™¤Nå‰
P((P))
PL[/"PL(k)"\]
N(("N(k)"))
R(("R(k-1)"))
NR[NIL]
RL[NIL]
RR[NIL]

P --> PL
P --> N
N --> R
N --> NR
R --> RL
R --> RR
end

classDef tree fill: white, color: black, stroke: black
classDef blackNode fill: black,color: white,stroke:none
classDef redNode fill: red,color: white,stroke: none
class G,U,N,NR,rl,rr,RL,RR blackNode
class R,r,p,P redNode
class PL,NL,UL,UR,pl tree
```

åˆ é™¤Nå, Næ‰€åœ¨è·¯å¾„çš„é»‘è‰²æ•°é‡å‡å°‘ï¼Œ å¿…ç„¶å¯¼è‡´ä¸åŒè·¯å¾„çš„é»‘è‰²æ•°é‡ä¸åŒï¼› ä¸”å½“Pä¸ºçº¢è‰²æ—¶ï¼Œ åˆç ´åäº†çº¢ç»“ç‚¹å­©å­å¿…é¡»ä¸ºé»‘ç»“ç‚¹çš„æ€§è´¨ã€‚

æ­¤æ—¶æˆ‘ä»¬å°†RæŸ“é»‘ï¼Œ å°±åŒæ—¶è§£å†³äº†ä¸¤æ¡æ€§è´¨çš„å¤±è¡¡é—®é¢˜:

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD
subgraph RæŸ“é»‘å
p((P))
pl[/"PL(k)"\]
r(("R(k)"))
rl[NIL]
rr[NIL]
p --> pl
p --> r
r --> rl
r --> rr
end
subgraph RæŸ“é»‘å‰
P((P))
PL[/"PL(k)"\]
R(("R(k-1)"))
RL[NIL]
RR[NIL]

P --> PL
P --> R
R --> RL
R --> RR
end

classDef tree fill: white, color: black, stroke: black
classDef blackNode fill: black,color: white,stroke:none
classDef redNode fill: red,color: white,stroke: none
class G,U,N,NR,r,rl,rr,RL,RR blackNode
class R,p,P redNode
class PL,NL,UL,UR,pl tree
```

##### åˆ é™¤æ“ä½œä¿®æ­£åŸç†

è®©æˆ‘ä»¬æ€è€ƒåˆ é™¤ä¸€ä¸ªé»‘è‰²ç»“ç‚¹Né€ æˆçš„åæœ, æœ¬è´¨ä¸Šå°±æ˜¯P(Nçš„çˆ¶äº²)çš„ä¸¤é¢—å­æ ‘çš„é»‘è‰²æ·±åº¦ä¸å†ç›¸ç­‰(**Næ‰€åœ¨å­æ ‘é»‘è‰²æ·±åº¦å‡ä¸€**)ï¼Œ æ­¤æ—¶è§£å†³æ–¹æ³•æ— é:

1. åœ¨ä¿è¯Pæ ‘é»‘è‰²æ·±åº¦ä¸å˜çš„æƒ…å†µä¸‹ï¼Œ å¼¥è¡¥Næ‰€åœ¨å­æ ‘å‡å°‘çš„é»‘è‰²æ·±åº¦, æ­¤æ—¶å¿…ç„¶éœ€è¦æœ‰ä¸€ä¸ªçº¢è‰²ç»“ç‚¹è¢«æŸ“æˆäº†é»‘è‰²ç»“ç‚¹
    * è¢«æŸ“é»‘çš„çº¢è‰²ç»“ç‚¹å“ªé‡Œæ¥? 
        * åœ¨Næ‰€åœ¨å­æ ‘ä¸Šï¼Œ ä»£æ›¿Nä½ç½®
        * åœ¨Så­æ ‘ä¸Š,  éœ€è¦è°ƒæ•´ç»“æ„è®©Nå­æ ‘å¤šä¸€ä¸ªé»‘è‰²ç»“ç‚¹
        * PæŸ“é»‘, SæŸ“çº¢
    
1. (1)æ— æ³•å®ç°çš„æƒ…å†µä¸‹, ç»´æŠ¤ä¸¤é¢—å­æ ‘é»‘è‰²æ·±åº¦ç›¸åŒä¸”å°†Pæ ‘æ•´ä½“çš„é»‘è‰²æ·±åº¦å‡ä¸€ï¼Œ æ­¤æ—¶ç›¸å½“äº"Pè¢«åˆ äº†"ï¼Œ å‘ä¸Šé€’å½’ç»´æŠ¤ã€‚

æˆ‘æƒ³è¡¨è¾¾çš„æ„æ€æ˜¯, åˆ é™¤é»‘è‰²å¶å­ç»“ç‚¹åçš„ç»´æŠ¤æ“ä½œ, åº”è¯¥å°†å…¶çœ‹ä½œä¸€ä¸ªæ•´ä½“ã€ä¸€é¢—å­æ ‘çš„é»‘è‰²æ·±åº¦å‡ä¸€ï¼Œ ä½†å®ƒå†…éƒ¨ä¾ç„¶ç¬¦åˆçº¢é»‘æ ‘æ€§è´¨ï¼Œ è¿™æ ·å»ç†è§£ï¼Œ è¿›è€Œå¤ç”¨åˆ°æ›´å¹¿çš„æƒ…å†µã€‚

æˆ‘ä»¬é‡å›`(5)`çš„æƒ…å†µ, 5çš„æƒ…å†µæœ¬è´¨æ˜¯Nå­æ ‘çš„é»‘è‰²æ•°é‡å‡äº†1ï¼Œ æ‰€ä»¥ç”¨äº†ä¸€ä¸ªæœ¬èº«åœ¨Nå­æ ‘ä¸Šçš„çº¢è‰²ç»“ç‚¹æŸ“é»‘è¿›è¡Œæ›¿ä»£

è€Œåœ¨Nå­æ ‘å†…éƒ¨è§£å†³ä¸äº†é—®é¢˜ï¼Œ å°±å°†é—®é¢˜æŠ›ç»™äº†ä¸Šå±‚ã€‚ 

**Pä¸ºçº¢è‰², Så’ŒSä¸¤ä¸ªå­©å­å‡ä¸ºé»‘è‰² **

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD
subgraph ç»´æŠ¤å
p((P))
n((N))
s((S))
sl((SL))
sr((SR))
p --> n
p --> s
s --> sl
s --> sr
end
subgraph å¤±è¡¡
P((P))
N((N))
S((S))
SL((SL))
SR((SR))

P --> N
P --> S
S --> SL
S --> SR
end
classDef tree fill: white, color: black, stroke: black
classDef blackNode fill: black,color: white,stroke:none
classDef redNode fill: red,color: white,stroke: none
class P,s redNode;
class S,N,SL,SR,p,sl,sr,n blackNode;
class PL,NL,UL,UR,pl tree
```

æ­¤æ—¶å°†PæŸ“é»‘ã€SæŸ“çº¢, æ˜¾ç„¶ç¬¦åˆ:

1. På­æ ‘å’ŒSè·¯å¾„é»‘è‰²æ·±åº¦ä¸å˜
2. så­æ ‘çº¢é»‘æ ‘æ€§è´¨æœªé­åˆ°ç ´å
3. Nè·¯å¾„é»‘è‰²æ·±åº¦+1

å³æˆåŠŸçš„ä¸ºNæ“¦äº†å±è‚¡ã€‚

```typescript
sibling.setRed();
parent.setBlack();
```



**Pä¸ºé»‘è‰²ï¼Œ Så’ŒSä¸¤ä¸ªå­©å­å‡ä¸ºé»‘è‰²**

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD
subgraph ç»´æŠ¤å
P((P))
N((N))
S((S))
SL((SL))
SR((SR))

P --> N
P --> S
S --> SL
S --> SR
end
subgraph å¤±è¡¡
p((P))
n((N))
s((S))
sl((SL))
sr((SR))
p --> n
p --> s
s --> sl
s --> sr
end
classDef tree fill: white, color: black, stroke: black
classDef blackNode fill: black,color: white,stroke:none
classDef redNode fill: red,color: white,stroke: none
class S redNode;
class S,N,SL,SR,p,sl,sr,n,s,P blackNode;
class PL,NL,UL,UR,pl tree
```



æˆ‘ä»¬å°†SæŸ“çº¢ï¼Œ Pçš„ä¸¤æ¡è·¯å¾„ä¸‹çš„é»‘è‰²æ·±åº¦éƒ½å‡ä¸€, å°†é—®é¢˜æŠ›ç»™ä¸Šå±‚ã€‚

```typescript
sibling.setRed();
this.maintain(parent.parent);
```

**Pä»»æ„, Sä¸ºé»‘è‰²ï¼Œ Nè¿œä¾„ä¸ºçº¢è‰², è¿‘ä¾„ä»»æ„**

> å½“Nä¸ºPå·¦å„¿å­æ—¶ï¼Œ Sçš„å·¦å„¿å­ä¸ºè¿‘ä¾„ï¼Œ å³å„¿å­ä¸ºè¿œä¾„ï¼› åä¹‹åŒç†ã€‚

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD
subgraph ç»´æŠ¤å
P((P))
N((N))
S((S))
SL((SL))
SR((SR))

S --> P
P --> N
S --> SR
P --> SL
end
subgraph å¤±è¡¡
p((P))
n((N))
s((S))
sl((SL))
sr((SR))
p --> n
p --> s
s --> sl
s --> sr
end
classDef tree fill: white, color: black, stroke: black
classDef blackNode fill: black,color: white,stroke:none
classDef redNode fill: red,color: white,stroke: none
class sr redNode;
class N,SR,n,s,P blackNode;
class PL,NL,UL,UR,pl,sl,p,SL,S tree
```

1. På‘Næ–¹å‘æ—‹è½¬
2. Så’ŒPäº¤æ¢é¢œè‰², è¿œä¾„æŸ“é»‘

æ­¤æ—¶å„æ–¹é¢éƒ½æ»¡è¶³æ€§è´¨

**Pä»»æ„,  Nè¿‘ä¾„ä¸ºçº¢è‰²ï¼Œ è¿œä¾„ä¸ºé»‘è‰²**

```mermaid
%%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
flowchart TD
subgraph ç»´æŠ¤å
p((P))
n((N))
sll[/ \]
slr[/ \]
s((S))
sl((SL))
sr((SR))
p --> n
p --> sl
sl --> sll
sl --> s
s --> slr
s --> sr

end
subgraph å¤±è¡¡
P((P))
N((N))
S((S))
SL((SL))
SR((SR))

P --> N
P --> S
S --> SL
S --> SR

end
classDef tree fill: white, color: black, stroke: black
classDef blackNode fill: black,color: white,stroke:none
classDef redNode fill: red,color: white,stroke: none
class SL,s redNode;
class N,SR,n,S,sr,sl blackNode;
class PL,NL,UL,UR,pl,p,P,sll,slr tree
```

1. å°†Så‘è¿œä¾„æ–¹å‘å³æ—‹
2. å°†è¿‘ä¾„æŸ“é»‘ï¼Œ SæŸ“çº¢

æ­¤æ—¶æƒ…å†µå˜ä¸ºäº†**Pä»»æ„, Sä¸ºé»‘è‰²ï¼Œ Nè¿œä¾„ä¸ºçº¢è‰², è¿‘ä¾„ä»»æ„**, ç”¨åŒæ ·æ–¹æ³•è§£å†³å³å¯ã€‚

ä»¥ä¸Šå››ç§æƒ…å†µï¼Œ æˆ‘ä»¬æšä¸¾å®Œäº†Sä¸ºé»‘è‰²çš„æ‰€æœ‰æƒ…å†µ, æ¥ä¸‹æ¥è€ƒè™‘Sä¸ºçº¢è‰²çš„æƒ…å†µ

**Sä¸ºçº¢è‰²**

æ­¤æ—¶På’ŒSçš„å­©å­åªèƒ½ä¸ºé»‘è‰², ä¸”Så¿…ç„¶æœ‰çœŸå®å­©å­

1. På‘Næ–¹å‘æ—‹è½¬
2. PæŸ“çº¢, SæŸ“é»‘

 ```mermaid
 %%{ init: { 'flowchart': { 'curve': 'basis' } } }%%
 flowchart TD
 subgraph ç»´æŠ¤å
 s((S))
 p((P))
 sr((SR))
 n((N))
 sl((SL))
 
 s --> p
 p --> n
 p --> sl
 s --> sr
 end
 subgraph å¤±è¡¡
 P((P))
 N((N))
 S((S))
 SL((SL))
 SR((SR))
 
 P --> N
 P --> S
 S --> SL
 S --> SR
 end
 classDef tree fill: white, color: black, stroke: black
 classDef blackNode fill: black,color: white,stroke:none
 classDef redNode fill: red,color: white,stroke: none
 class S,p redNode;
 class N,P,SL,SR,s,n,sl,sr blackNode;
 class PL,NL,UL,UR,pl tree
 ```

æ­¤æ—¶å¯ä»¥å‘ç°æ•´æ£µæ ‘ç›¸æ¯”ä¹‹å‰çš„å˜åŒ–å°±æ˜¯Nä¸‹ç§»ï¼Œ siblingå˜ä¸ºäº†SLï¼Œ å…¶ä»–éƒ¨åˆ†å¹¶æœªå¤±è¡¡ã€‚

ç»§ç»­åœ¨æ–°çš„På­æ ‘ä¸Šç»§ç»­ç»´æŠ¤å³å¯ã€‚

```typescript
if (sibling.isRed()) {
  if (direction === DIRECTION.LEFT) {
    this.rotateLeft(parent);
  } else {
    this.rotateRight(parent);
  }
  sibling.setBlack();
  parent.setRed();
  this.afterErase(parent);
}
```



### çº¢é»‘æ ‘å’ŒAVLæ ‘çš„æ¯”è¾ƒ

1. å¦‚æœæ’å…¥ä¸€ä¸ªnodeå¼•èµ·äº†æ ‘çš„ä¸å¹³è¡¡ï¼ŒAVLå’ŒRB-Treeéƒ½æ˜¯æœ€å¤šåªéœ€è¦2æ¬¡æ—‹è½¬æ“ä½œï¼Œå³ä¸¤è€…éƒ½æ˜¯O(1)ï¼›ä½†æ˜¯åœ¨åˆ é™¤nodeå¼•èµ·æ ‘çš„ä¸å¹³è¡¡æ—¶ï¼Œæœ€åæƒ…å†µä¸‹ï¼ŒAVLéœ€è¦ç»´æŠ¤ä»è¢«åˆ nodeåˆ°rootè¿™æ¡è·¯å¾„ä¸Šæ‰€æœ‰nodeçš„å¹³è¡¡æ€§ï¼Œå› æ­¤éœ€è¦æ—‹è½¬çš„é‡çº§O(logN)ï¼Œè€ŒRB-Treeæœ€å¤šåªéœ€3æ¬¡æ—‹è½¬ï¼Œåªéœ€è¦O(1)çš„å¤æ‚åº¦ã€‚
2. AVLçš„ç»“æ„ç›¸è¾ƒRB-Treeæ¥è¯´æ›´ä¸ºå¹³è¡¡ï¼Œåœ¨æ’å…¥å’Œåˆ é™¤nodeæ›´å®¹æ˜“å¼•èµ·Treeçš„unbalanceï¼Œå› æ­¤åœ¨å¤§é‡æ•°æ®éœ€è¦æ’å…¥æˆ–è€…åˆ é™¤æ—¶ï¼ŒAVLéœ€è¦rebalanceçš„é¢‘ç‡ä¼šæ›´é«˜ã€‚å› æ­¤ï¼ŒRB-Treeåœ¨éœ€è¦å¤§é‡æ’å…¥å’Œåˆ é™¤nodeçš„åœºæ™¯ä¸‹ï¼Œæ•ˆç‡æ›´é«˜ã€‚è‡ªç„¶ï¼Œç”±äºAVLé«˜åº¦å¹³è¡¡ï¼Œå› æ­¤AVLçš„searchæ•ˆç‡æ›´é«˜ã€‚

## å‚è€ƒ

[rbtree.c-linuxæºç ](https://elixir.bootlin.com/linux/latest/source/lib/rbtree.c)

[çº¢é»‘æ ‘ - OI Wiki (oi-wiki.org)](https://oi-wiki.org/ds/rbtree/#case-4)

[çº¢é»‘æ ‘ï¼ˆå›¾è§£+ç§’æ‡‚+å²ä¸Šæœ€å…¨ï¼‰ - ç–¯ç‹‚åˆ›å®¢åœˆ - åšå®¢å›­ (cnblogs.com)](https://www.cnblogs.com/crazymakercircle/p/16320430.html#autoid-h3-8-8-0)

[çº¢é»‘æ ‘ | Jasonâ€˜s Blog (jasonxqh.github.io)](https://jasonxqh.github.io/2020/11/03/çº¢é»‘æ ‘/)

[æ•°æ®ç»“æ„-Bæ ‘ä¸çº¢é»‘æ ‘ - Shuzang's Blog](http://shuzang.top/2020/data-structure-b-tree-and-red-black-tree/#24-åˆ é™¤)

[Redâ€“black tree - Wikipedia](https://en.wikipedia.org/wiki/Redâ€“black_tree)

[The-Art-Of-Programming-By-July-2nd/ebook/zh/03.01.md at master Â· julycoding/The-Art-Of-Programming-By-July-2nd (github.com)](https://github.com/julycoding/The-Art-Of-Programming-By-July-2nd/blob/master/ebook/zh/03.01.md)

[å¹³è¡¡æ ‘ - ç»´åŸºç™¾ç§‘ï¼Œè‡ªç”±çš„ç™¾ç§‘å…¨ä¹¦ (wikipedia.org)](https://zh.wikipedia.org/wiki/å¹³è¡¡æ ‘)

Weiss M A. æ•°æ®ç»“æ„ä¸ç®—æ³•åˆ†æ Cè¯­è¨€æè¿°ï¼ˆç¬¬2ç‰ˆï¼‰. å†¯èˆœçº è¯‘. æœºæ¢°å·¥ä¸šå‡ºç‰ˆç¤¾, 2004.

## çº¢é»‘æ ‘å‚è€ƒä»£ç 

rb-node.ts:

```typescript
type COLOR = "RED" | "BLACK";
export type NIL = null;
export enum DIRECTION {
  LEFT = 'left',
  RIGHT = 'right',
  ROOT = 'root'
}

export class TreeNode<K, V, N extends TreeNode<K, V, N>> {
  key: K;
  value: V;
  left: N | NIL = null;
  right: N | NIL = null;
  parent: N | NIL = null;

  constructor(key: K, value: V) {
    this.key = key;
    this.value = value;
  }

  isRoot() {
    return this.parent === null;
  }

  isLeaf() {
    return this.left === null && this.right === null;
  }
  
  setLeftChild(child: N | null) {
    this.left = child;
    child && (child.parent = this as unknown as N);
    return this;
  }
  
  setRightChild(child: N | null) {
    this.right = child;
    child && (child.parent = this as unknown as N);
    return this;
  }

  direction() {
    if (this.parent === null) return DIRECTION.ROOT;
    if (this.parent.left === this as unknown as N) return DIRECTION.LEFT;
    else return DIRECTION.RIGHT;
  }

  sibling() {
    const direct = this.direction();
    if (direct === DIRECTION.LEFT) {
      return this.parent?.right;
    } else {
      return this.parent?.left;
    }
  }

  hasSibling() {
    return !this.isRoot() && this.sibling();
  }

  uncle() {
    return this.parent?.sibling() || null;
  }

  hasUncle() {
    return this.parent?.hasSibling();
  }
}

const tree = new TreeNode('1', 2);

export class RB_Node<K, V> extends TreeNode<K, V, RB_Node<K, V>> {
  color: COLOR = "RED";

  constructor(key: K, value: V) {
    super(key, value);
  }

  isRed() {
    return this.color === "RED";
  }
  
  isBlack() {
    return this.color === "BLACK"
  }

  setBlack() {
    this.color = "BLACK";
    return this;
  }
  
  setRed() {
    this.color = "RED";
    return this;
  }

  static isRed(node: RB_Node<any, any> | null) {
    return node && node.isRed();
  }

  static isBlack(node: RB_Node<any, any> | null) {
    return !node || node.isBlack();
  }
}

```



Rbtree.ts:

```typescript
import { RB_Node, NIL, DIRECTION, TreeNode } from './rb-node.js';
const isDev = true;

enum COMPARE_RESULT {
  EQUAL = 0,
  LESS = -1,
  MORE = 1
}

type Compare<K> = (a: K, b: K) => 
  COMPARE_RESULT.MORE |  // a > b
  COMPARE_RESULT.EQUAL |  // a === b
  COMPARE_RESULT.LESS;  // a < b

/**
 * newChildæ›¿æ¢oldChildçš„ä½ç½®, par
 * @param parent oldChildçš„çˆ¶ç»“ç‚¹
 * @param oldChild åŸç»“ç‚¹
 * @param newChild æ–°ç»“ç‚¹
 * @param setRoot å°†æ–°ç»“ç‚¹è®¾ç½®ä¸ºæ ¹ç»“ç‚¹
 */
function changeChild<N extends TreeNode<any, any, N>>(parent: N, oldChild: N, newChild: N | null, setRoot?: (node: N | null) => void) {
  switch (oldChild.direction()) {
    case DIRECTION.LEFT:
      parent.setLeftChild(newChild);
      break;
    case DIRECTION.RIGHT:
      parent.setRightChild(newChild);
      break;
    case DIRECTION.ROOT:
      setRoot && setRoot(newChild);
      break;
  }
}

export class BS_Tree<K, V, N extends TreeNode<K, V, N>> {
  protected root: N | NIL = null;
  protected compare: Compare<K>;

  constructor(compare?: Compare<K>) {
    this.compare = compare || ((a, b) => {
      return a === b ? 0 : (a > b ? 1 : -1);
    });
  }

  setRoot(node: N | null) {
    this.root = node;
    node && (node.parent = null);
  }

  Traversal(root: N | null, callback: (node: N) => void) {
    if (root === null) return;
    callback(root);
    this.Traversal(root.right, callback);
    this.Traversal(root.left, callback);
  }

  /**
   * é€’å½’åœ°å°†ç»“ç‚¹æ’å…¥äºŒå‰æœç´¢æ ‘
   * @param root è¢«æ’å…¥çš„æ ‘çš„æ ¹
   * @param node æ’å…¥çš„ç»“ç‚¹
   * @param replace ç»“ç‚¹keyç›¸åŒæ—¶æ˜¯å¦ç›´æ¥æ›¿æ¢
   */
  insertNode(root: N | null, node: N, replace: boolean = true) {
    if (root === null) {
      this.setRoot(node);
      return node;
    }
    const compareResult = this.compare(root.key, node.key);
    if (compareResult === COMPARE_RESULT.EQUAL) {
      replace && (root.value = node.value);
    } else if (compareResult === COMPARE_RESULT.MORE) {
      if (root.left !== null) {
        this.insertNode(root.left, node, replace);
      } else {
        root.setLeftChild(node);
      }
    } else {
      if (root.right !== null) {
        this.insertNode(root.right, node, replace);
      } else {
        root.setRightChild(node);
      }
    }
  }

  

  /**
   * æ ¹æ®é”®å€¼åœ¨æ ‘ä¸­æŸ¥æ‰¾ç»“ç‚¹
   * @param root å­æ ‘æ ¹
   * @param key æ¬²åˆ é™¤çš„é”®å€¼
   * @returns æŸ¥æ‰¾ç»“æœ Node | null
   */
  searchNode(root: N | null, key: K): N | null {
    if (root === null) return null;
    const compareResult = this.compare(root.key, key);
    switch (compareResult) {
      case COMPARE_RESULT.EQUAL:
        return root;
      case COMPARE_RESULT.LESS:
        return this.searchNode(root.right, key);
      case COMPARE_RESULT.MORE:
        return this.searchNode(root.left, key);
    }
  }

  /**
   * æ ¹æ®é”®å€¼åœ¨æ ‘ä¸­åˆ é™¤ä¸€ä¸ªç»“ç‚¹, å¹¶è¿”å›åˆ é™¤çš„ç»“ç‚¹
   * 
   */
  eraseNode(root: N | null, key: K, copyData?: (target: N, source: N) => void): N | null {
    const node = this.searchNode(root, key);

    if (node === null) return null;

    if (node.left && node.right) {
      // nodeæœ‰ä¸¤ä¸ªå­©å­, ä½¿ç”¨å‰é©±ç»“ç‚¹æ›¿æ¢node
      const leftMax = this.leftMaxNode(node)!;
      console.assert(leftMax !== null, "leftMax should not be null when node has two children");
      // å‰é©±ç»“ç‚¹ä¸nodeäº¤æ¢æ•°æ®
      if (copyData) {
        copyData(node, leftMax!);
      } else {
        node.key = leftMax!.key;
        node.value = leftMax!.value;
      }

      // åˆ é™¤åŸå‰é©±ç»“ç‚¹, å‰é©±ç»“ç‚¹å¿…ç„¶æ²¡æœ‰å³å„¿å­
      const leftMaxParent = leftMax.parent!;
      console.assert(leftMaxParent !== null, "leftMax should have parent");
      console.assert(leftMax.right === null, "leftMax should not have right child");
      changeChild<N>(leftMaxParent, leftMax, leftMax.left, (node) => {
        this.setRoot(node);
      });
      return leftMax;
    } else if (node.left) {
      // å·¦ç»“ç‚¹é¡¶æ›¿nodeä½ç½®
      const parent = node.parent;
      changeChild(parent!, node, node.left, (node) => {
        this.setRoot(node);
      });
    } else if (node.right) {
      // å³ç»“ç‚¹é¡¶æ›¿nodeä½ç½®
      const parent = node.parent;
      changeChild(parent!, node, node.right, (node) => {
        this.setRoot(node);
      });
    } else {
      // nodeä¸ºå¶å­ç»“ç‚¹, ç›´æ¥åˆ é™¤
      changeChild<N>(node.parent!, node, null, (node) => {
        this.setRoot
      });
    }
    return node;
  }

  /**
   * å·¦å­æ ‘ä¸­çš„æœ€å¤§keyç»“ç‚¹
   * @param root å­æ ‘æ ¹
   * @returns 
   */
  leftMaxNode(root: N | null): N | null {
    if (root === null || root.left === null) return null;
    let node = root.left!;
    while (node.right !== null) {
      node = node.right;
    }
    return node;
  }
}

/**
 * çº¢é»‘æ ‘
 * å‚è€ƒlinuxçº¢é»‘æ ‘æºç : https://elixir.bootlin.com/linux/latest/source/lib/rbtree.c
 * éµå¾ªæ€§è´¨å¦‚ä¸‹:
 * 1. æ¯ä¸ªç»“ç‚¹è¦ä¹ˆæ˜¯çº¢è‰², è¦ä¹ˆæ˜¯é»‘è‰²
 * 2. rootæ˜¯é»‘è‰²
 * 3. æ¯ä¸ªå¶ç»“ç‚¹(NIL)æ˜¯é»‘è‰²
 * 4. çº¢è‰²ç»“ç‚¹çš„å­ç»“ç‚¹éƒ½æ˜¯é»‘è‰²
 * 5. ä»ä»»æ„ç»“ç‚¹åˆ°å…¶æ¯ä¸ªå¶ç»“ç‚¹çš„è·¯å¾„ä¸ŠåŒ…å«ç›¸åŒæ•°é‡çš„é»‘è‰²ç»“ç‚¹
 * 
 */
export class RB_Tree<K, V> extends BS_Tree<K, V, RB_Node<K, V>> {

  constructor(compare?: Compare<K>) {
    super(compare);
  }

  get(key: K) {
    const node = this.searchNode(this.root, key);
    return node ? node.value : null;
  }

  insert(key: K, value: V) {
    const node = new RB_Node(key, value);
    this.insertNode(this.root, node);
    this.afterInsert(node);
  }

  /**
   * å·¦æ—‹æ“ä½œ
   * @param node å·¦æ—‹çš„å­æ ‘æ ¹ç»“ç‚¹, éœ€è¦ä¿è¯ä¸ä¸ºç©ºä¸”å³å­æ ‘ä¸ä¸ºç©º 
   * 
   *        g           p
   *       / \         / \
   *      u   p  -->  g   n
   *         / \     / \    
   *        m   n   u   m     
   */
  rotateLeft(node: RB_Node<K, V>) {
    console.assert(node !== null && node.right !== null, "node and node->left should not be null in rotateLeft");
    const parent = node.parent;
    const direction = node.direction();
    const successor = node.right!;
    // å·¦æ—‹æ ¸å¿ƒæ“ä½œ, æ ¹å˜ä¸ºsuccessorçš„å·¦å­æ ‘, successorå˜ä¸ºæ ¹
    node.setRightChild(successor.left);
    successor.setLeftChild(node);

    // nodeçš„ä½ç½®ä¸ºsuccessorå–ä»£, éœ€è¦æ›´æ–°nodeçš„çˆ¶ç»“ç‚¹ä¸successorçš„å…³ç³»
    switch (direction) {
      case DIRECTION.LEFT:
        console.assert(parent !== null, "parent should not be null when direction is left");
        parent!.setLeftChild(successor);
        break;
      case DIRECTION.RIGHT:
        console.assert(parent !== null, "parent should not be null when direction is right");
        parent!.setRightChild(successor);
        break;
      case DIRECTION.ROOT:
        this.setRoot(successor);
        break;
    }
  }

  /**
   * å³æ—‹æ“ä½œ
   * @param node å³æ—‹çš„å­æ ‘æ ¹ç»“ç‚¹, éœ€è¦ä¿è¯ä¸ä¸ºç©ºä¸”å·¦å­æ ‘ä¸ä¸ºç©º
   * 
   *        g           p
   *       / \         / \
   *      p   u  -->  n   g
   *     /  \            / \
   *    n    m          m   u
   */
  rotateRight(node: RB_Node<K, V>) {
    console.assert(node !== null && node.left !== null, "node and node->left should not be null in rotateRight");

    const parent = node.parent;
    const direction = node.direction();
    const successor = node.left!;

    node.setLeftChild(successor.right);
    successor.setRightChild(node);

    switch (direction) {
      case DIRECTION.LEFT:
        console.assert(parent !== null, "parent should not be null when direction is left");
        parent!.setLeftChild(successor);
        break;
      case DIRECTION.RIGHT:
        console.assert(parent !== null, "parent should not be null when direction is right");
        parent!.setRightChild(successor);
        break;
      case DIRECTION.ROOT:
        this.setRoot(successor);
        break;
    }
  }

  /**
   * ç»´æŠ¤æ’å…¥ç»“ç‚¹åçš„æ ‘ä½¿å…¶æ»¡è¶³çº¢é»‘æ ‘æ€§è´¨
   * @node åˆšè¢«æ’å…¥çš„ç»“ç‚¹
   */
  afterInsert(node: RB_Node<K, V>) {
    // æ’å…¥ç»“ç‚¹çš„çˆ¶ç»“ç‚¹, ä»¥çˆ¶äº²ä»£ç§°
    const parent = node.parent;
    /**
     * case1: æ’å…¥çš„ç»“ç‚¹ä¸ºæ ¹èŠ‚ç‚¹
     * å°†å…¶æŸ“é»‘å³å¯
     */
    if (parent === null) {
      node.setBlack();
      isDev && console.log('case1');
      return;
    }

    /**
     * case2: æ’å…¥ç»“ç‚¹çš„çˆ¶ç»“ç‚¹ä¸ºé»‘è‰²
     * ä¸ä¼šç ´åçº¢é»‘æ ‘æ€§è´¨, ç›´æ¥ç»“æŸ
     */
    if (parent.isBlack()) {
      isDev && console.log('case2');
      return;
    }

    // æ’å…¥ç»“ç‚¹çš„çˆ·çˆ·ç»“ç‚¹, ä»¥çˆ·çˆ·ä»£ç§°
    // çˆ·çˆ·å¿…ç„¶å­˜åœ¨, å› ä¸ºå¦‚æœçˆ¶äº²æ˜¯æ ¹èŠ‚ç‚¹, å¿…ç„¶æ˜¯é»‘è‰², é‚£ä¹ˆä¸ä¼šè¿›å…¥è¿™ä¸€æ­¥
    const gparent = parent.parent!;
    console.assert(gparent !== null, "gparent should not be null in pass case2");

    // å”å”
    const uncle = gparent && node.uncle();

    /**
     * case3: çˆ¶äº²å’Œå”å”éƒ½ä¸ºçº¢è‰²
     *
     *       G            g
     *      / \          / \
     *     p   u  -->   P   U
     *    /            /
     *   n            n
     * step1: å°†çˆ·çˆ·å˜ä¸ºçº¢è‰², å”å”å’Œçˆ¶äº²å˜ä¸ºé»‘è‰²
     *  æ­¤æ—¶çˆ·çˆ·å­æ ‘ç¬¦åˆçº¢é»‘æ ‘æ€§è´¨ä¸”æ·±åº¦ä¸å˜, ä½†ç”±äºçˆ·çˆ·å˜ä¸ºäº†çº¢è‰²å¯èƒ½ä¼šç ´åæ›´ä¸Šå±‚çš„æ€§è´¨, æ‰€ä»¥éœ€è¦é€’å½’ç»´æŠ¤çˆ·çˆ·
     * step2: å°†çˆ·çˆ·è§†ä¸ºåˆšæ’å…¥çš„çº¢è‰²ç»“ç‚¹, é€’å½’çš„è¿›è¡Œç»´æŠ¤
     */
    if (RB_Node.isRed(uncle)) {
      isDev && console.log('case3');
      console.assert(uncle !== null, "uncle should not be null when uncle is red");
      uncle!.setBlack();
      parent.setBlack();
      gparent.setRed();
      this.afterInsert(gparent);
      return;
    }

    /**
     * å”å”ä¸ºé»‘è‰²(æˆ–ä¸å­˜åœ¨)
     */
    if (RB_Node.isBlack(uncle)) {
      /**
       * case4: çˆ¶äº²ä¸ºçº¢è‰², å”å”ä¸ºé»‘è‰²(æˆ–ä¸å­˜åœ¨), ä¸”æ’å…¥ç»“ç‚¹ä¸çˆ¶ç»“ç‚¹å¼‚å‘(LR/RLå‹å¤±è¡¡)
       * ğŸ‘pæ–¹å‘ä¸ºå·¦ï¼Œ åˆ™å¯¹pè¿›è¡Œå·¦æ—‹; åä¹‹å³æ—‹ã€‚
       * ä»¥å·¦ä¸¾ä¾‹, på·¦æ—‹å, på’Œnçš„æ–¹å‘éƒ½å˜ä¸ºäº†å·¦, å³åŒå‘, æ­¤æ—¶é—®é¢˜è½¬åŒ–ä¸ºäº†case5
       *        G           G
			 *       / \         / \
			 *      p   U  -->  n   U
			 *     /  \        / \
			 *    m    n      p   q
       *        / \    / \
       *       o   q  m   o
       */

      if (parent.direction() !== node.direction()) {
        isDev && console.log('case4');
        if (node.direction() === DIRECTION.LEFT) {
          this.rotateLeft(parent);
        } else {
          this.rotateRight(parent);
        }
      }

      /**
       * case5: çˆ¶äº²ä¸ºçº¢è‰², å”å”ä¸ºé»‘è‰²(æˆ–ä¸å­˜åœ¨), ä¸”æ’å…¥ç»“ç‚¹ä¸çˆ¶ç»“ç‚¹åŒå‘(LL/RRå‹å¤±è¡¡)
       *
       *        (LLå‹å¤±è¡¡â€”â€”å³æ—‹)
			 *        G           P
			 *       / \         / \
			 *      p   U  -->  n   g
			 *     /  \            / \
			 *    n    m          m   U
       * 
       *         (RRå‹å¤±è¡¡â€”â€”å·¦æ—‹)
			 *        G           P
			 *       / \         / \
			 *      U   p  -->  g   n
			 *         / \     / \    
			 *        m   n   U   m     
       * 
       * åˆå§‹æƒ…å†µ: ä¸ç¬¦åˆ(4)
       * step1: åŸºäºçˆ·çˆ·åš(LL: å³æ—‹, RR: å·¦æ—‹)
       * æ­¤æ—¶çˆ¶äº²ç§»åŠ¨åˆ°äº†çˆ·çˆ·çš„ä½ç½®, çˆ·çˆ·åœ¨å”å”æ–¹å‘ä¸‹ç§»ï¼Œ æ­¤æ—¶æ’å…¥ç»“ç‚¹æ‰€åœ¨åˆ†æ”¯çš„é»‘è‰²æ·±åº¦å‡ä¸€
       * æ­¤æ—¶æƒ…å†µ: ä¸ç¬¦åˆ(4)(5)
       * step2: å°†çˆ¶äº²å˜ä¸ºé»‘è‰²ï¼Œ çˆ·çˆ·å˜ä¸ºçº¢è‰²
       * çˆ·çˆ·æ‰€åœ¨åˆ†æ”¯é»‘è‰²æ·±åº¦å‡ä¸€
       * çˆ¶äº²å˜ä¸ºé»‘è‰²åï¼Œ æ•´ä¸ªå­æ ‘çš„é»‘è‰²æ·±åº¦åŠ ä¸€ï¼Œ æ’å…¥å‰åçš„é»‘è‰²æ·±åº¦æ²¡æœ‰å˜åŒ–
       * åŒæ—¶på’Œné¢œè‰²ä¹Ÿä¸åŒ
       * æ­¤æ—¶æƒ…å†µ: ç¬¦åˆæ‰€æœ‰æ€§è´¨
       */
      if (parent.direction() === node.direction()) {
        isDev && console.log('case5');
        if (node.direction() === DIRECTION.LEFT) {
          // LLå‹å¤±è¡¡
          this.rotateRight(gparent);
        } else {
          // RRå‹å¤±è¡¡
          this.rotateLeft(gparent);
        }

        parent.setBlack();
        gparent.setRed();
      }
      return;
    }
    console.assert(false, "should not reach here in afterInsert");
  }

  erase(key: K) {
    // æ³¨æ„æ­¤æ—¶delNodeå·²ä»æ ‘ä¸­åˆ é™¤ï¼Œ ä½†delNodeçš„parentã€leftã€rightç­‰å±æ€§ä»ç„¶å¯ç”¨
    let delNode = this.eraseNode(this.root, key, (target, source) => {
      target.key = source.key;
      target.value = source.value;
    });

    console.assert(delNode === null || delNode.key === key, "delNode should have the same key as key")
    /**
     * å½“åˆ é™¤ç»“ç‚¹ä¸ºnullæˆ–è€…çº¢è‰²ç»“ç‚¹æˆ–è€…ä¸ºæ ‘ä¸­å”¯ä¸€çš„ç»“ç‚¹æ—¶, ä¸éœ€è¦è¿›è¡Œè°ƒæ•´
     */
    if (delNode === null || delNode.isRed() || this.root === null) return;

    /**
     * åˆ é™¤ç»“ç‚¹ä¸ºé»‘è‰²ç»“ç‚¹ && æœ‰ä¸€ä¸ªå­©å­(å¿…ä¸ºçº¢è‰²)
     * ç›´æ¥å°†å­©å­æŸ“é»‘å³å¯
     */
    if (delNode.left || delNode.right) {
      console.assert(!(delNode.left && delNode.right), "delNode should not have two children");
      delNode.left && delNode.left.setBlack();
      delNode.right && delNode.right.setBlack();
    }
    console.log('erase Node', delNode.key, delNode.parent?.key);
    /**
     * åˆ é™¤ç»“ç‚¹ä¸ºé»‘è‰²å¶å­
     */
    this.afterErase(delNode.parent!, null);
  }

  /**
   * nodeå­æ ‘çš„é»‘è‰²æ·±åº¦å‡ä¸€, éœ€è¦ä¿®æ­£çº¢é»‘æ ‘æ€§è´¨
   * @param parent è¢«åˆ é™¤ç»“ç‚¹çš„çˆ¶ç»“ç‚¹
   * @param node è¢«åˆ é™¤çš„ç»“ç‚¹ï¼Œ äº‹å®ä¸Šnodeåªéœ€è¦ç”¨æ¥å¸®åŠ©ç¡®è®¤siblingå’Œdirection
   */
  afterErase(parent: RB_Node<K, V>, node: RB_Node<K, V> | null) {
    isDev && console.log('erase maintain');
    /**
     * nodeå¿…ç„¶æœ‰siblings, å› ä¸ºnodeå­æ ‘çš„é»‘è‰²æ•´ä½“å‡ä¸€, è¯´æ˜åŸæ¥çš„é»‘è‰²æ·±åº¦ä¸ä¸º0ï¼Œ æ‰€ä»¥siblingå­æ ‘ä¸ä¸ºç©º
     */
    const sibling = (parent.left === node ? parent.right : parent.left)!;
    const direction = parent.left === node ? DIRECTION.LEFT : DIRECTION.RIGHT;
    console.assert(sibling !== null, "delNode must have sibling");

    /**
     * case1: siblingä¸ºçº¢è‰²
     * æ­¤æ—¶på¿…ç„¶ä¸ºé»‘è‰², nçš„ä¾„å­ä¹Ÿå¿…ç„¶ä¸ºé»‘è‰²
     * ä»¥Næ–¹å‘ä¸ºå·¦è·ç¦»
     * 1. å°±pè¿›è¡Œå·¦æ—‹
     * 2. å°†pæŸ“çº¢, å°†sæŸ“é»‘
     * 
     * æ­¤æ—¶Nçš„siblingä¸ºSlä¸ºé»‘è‰², ä¸”Så­æ ‘å³åˆ†æ”¯æ€§è´¨æœªç ´å
     * ç»§ç»­ç»´æŠ¤å³å¯
     *     P               S
     *    / \             / \
     *   N   s    -->    p   Sr
     *      / \         / \
     *     Sl  Sr      N   Sl
     *
     *     P               S
     *    / \             / \
     *   N   s    -->    p   Sr
     *      / \         / \
     *     Sl  Sr      N   Sl
     */
    if (sibling.isRed()) {
      isDev && console.log('case1');
      if (direction === DIRECTION.LEFT) {
        this.rotateLeft(parent);
      } else {
        this.rotateRight(parent);
      }
      sibling.setBlack();
      parent.setRed();
      this.afterErase(parent, node);
      return;
    }

    // closeNephew: siblingçš„æ–¹å‘ä¸nodeç›¸åŒçš„å­©å­
    // distantNephew: siblingçš„æ–¹å‘ä¸nodeç›¸åçš„å­©å­
    const closeNephew = sibling.direction() === DIRECTION.RIGHT ? sibling.left : sibling.right;
    const distantNephew = sibling.direction() === DIRECTION.RIGHT ? sibling.right : sibling.left;
    
    if (RB_Node.isBlack(closeNephew) && RB_Node.isRed(distantNephew)) {
      sibling.setRed();
      /**
       * case2: siblingä¸ºé»‘è‰² && siblingçš„ä¸¤ä¸ªå­ç»“ç‚¹éƒ½ä¸ºé»‘è‰² && parentä¸ºçº¢è‰²
       * å°†siblingæŸ“çº¢, parentæŸ“é»‘å³å¯
       * siblingåˆ†æ”¯çš„é»‘è‰²æ•°é‡ä¸å˜, nodeåˆ†æ”¯çš„é»‘è‰²æ•°é‡+1æŠµæ¶ˆäº†nodeåˆ é™¤åå‡1
       */
      if (parent.isRed()) {
        isDev && console.log('case2');
        parent.setBlack();
        return;
      }
      /**
       * case3: siblingä¸ºé»‘è‰² && siblingçš„ä¸¤ä¸ªå­ç»“ç‚¹éƒ½ä¸ºé»‘è‰² && parentä¸ºé»‘è‰²
       * å°†siblingæŸ“çº¢, æ­¤æ—¶parentå­æ ‘æ•´ä½“é»‘è‰²æ·±åº¦å‡ä¸€, å°†parentçœ‹ä½œè¢«åˆ é™¤çš„node, é€’å½’ç»´æŠ¤
       */
      isDev && console.log('case3');
      this.afterErase(parent.parent!, parent);
      return;
    }

    /**
     * case4: closeNephewä¸ºçº¢è‰², distantNephewä¸ºé»‘è‰²
     * åŸºäºsiblingè¿›è¡Œæ—‹è½¬, è½¬åŒ–ä¸ºcase5
     */
    if (RB_Node.isRed(closeNephew) && RB_Node.isBlack(distantNephew)) {
      isDev && console.log('case4');
      console.assert(closeNephew !== null, "closeNephew should not be null when closeNephew is red")
      if (sibling.direction() === DIRECTION.LEFT) {
        this.rotateRight(sibling);
      } else {
        this.rotateLeft(sibling);
      }
      closeNephew?.setBlack();
      sibling.setRed();
      this.afterErase(parent, node);
      return;
    }

    /**
     * case5: closeNephewä¸ºé»‘è‰²æˆ–çº¢è‰², distantNephewä¸ºçº¢è‰²
     * 1. åŸºäºparentè¿›è¡Œæ—‹è½¬
     * 2. å°†siblingçš„é¢œè‰²å˜ä¸ºparentçš„é¢œè‰², parentå’ŒdistantNephewå˜ä¸ºé»‘è‰²
     */
    if (RB_Node.isRed(distantNephew)) {
      isDev && console.log('case5');
      console.assert(distantNephew !== null, "distantNephew should not be null when distantNephew is red");
      if (sibling.direction() === DIRECTION.RIGHT) {
        this.rotateLeft(parent);
      } else {
        this.rotateRight(parent);
      }
      sibling.color = parent.color;
      parent.setBlack();
      distantNephew && distantNephew.setBlack();
    }
  }

  show() {
    this.Traversal(this.root, (node) => {
      node.left && console.log(`${node.key}(${node.color}) --(left)--> ${node.left.key}(${node.left.color})`);
      node.right && console.log(`${node.key}(${node.color}) --(right)--> ${node.right.key}(${node.right.color})`);
    });
  }
}
```

